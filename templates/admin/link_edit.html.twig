{% extends "base.html.twig" %}

{% block title %}Éditer lien{% endblock %}

{% block body %}
	<div class="backoffice-container">
		<div class="page-header">
			<h1>Éditer le lien</h1>
			<p>Modifier les informations du lien</p>
		</div>

		<!-- Flash Messages -->
		{% for type, messages in app.flashes %}
			{% for message in messages %}
				<div class="alert alert-{{ type == 'error' ? 'danger' : type }} alert-dismissible fade show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}
		{% endfor %}

		<div class="card">
			<div class="card-body">
				<form method="post" action="{{ path('app_link_edit', {id: link.id}) }}">
					<input type="hidden" name="_token" value="{{ csrf_token('edit-link-' ~ link.id) }}">

					<div class="mb-3">
						<label for="title" class="form-label">Titre *</label>
						<input type="text" class="form-control" id="title" name="title" value="{{ link.title }}" required>
					</div>

					<div class="mb-3">
						<label for="url" class="form-label">URL *</label>
						<input type="url" class="form-control" id="url" name="url" value="{{ link.url }}" required>
					</div>

					<div class="mb-3">
						<label for="desc" class="form-label">Description</label>
						<textarea class="form-control" id="desc" name="desc" rows="3">{{ link.desc }}</textarea>
					</div>

					<div class="mb-3">
						<label class="form-label">Tags</label>
						<div class="tags-checkboxes">
							{% for tag in tags %}
								<div class="form-check">
									<input class="form-check-input" type="checkbox" name="tags[]" value="{{ tag.id }}" 
										id="tag{{ tag.id }}" {{ tag in link.tags ? 'checked' : '' }}>
									<label class="form-check-label" for="tag{{ tag.id }}">
										{{ tag.name }}
									</label>
								</div>
							{% endfor %}
						</div>
					</div>

					<div class="mb-3">
						<label for="new_tag" class="form-label">Ajouter un nouveau tag</label>
						<input type="text" class="form-control" id="new_tag" name="new_tag" placeholder="Nom du nouveau tag">
					</div>

					<div class="mb-3">
						<small class="form-text text-muted">
							<i class="bi bi-info-circle"></i>
							Partagé par {{ link.user ? link.user.username : 'Anonyme' }} le {{ link.createdAt|date('d/m/Y') }}
						</small>
					</div>

					<div class="d-flex gap-2">
						<button type="submit" class="btn btn-primary">
							<i class="bi bi-save"></i>
							Enregistrer
						</button>
						<a href="{{ path('app_backoffice', {tab: 'links'}) }}" class="btn btn-secondary">
							<i class="bi bi-x"></i>
							Annuler
						</a>
						<a href="{{ link.url }}" target="_blank" class="btn btn-info ms-auto">
							<i class="bi bi-box-arrow-up-right"></i>
							Voir le lien
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
{% endblock %}
